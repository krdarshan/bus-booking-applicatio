<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seat Confirmation</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <!-- Link to jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <form>
      <br />
      <div class="container">
        <div class="row">
          <div class="col-sm-8">
            <h1>Elite Travels #123</h1>
              <h3>Seat Confirmation</h3>
              <br>
              <div class = "row">
                <div class = "col-sm-4">
                  <h5>
                    <span class = "badge badge-danger">&nbsp;&nbsp;</span>
                    Not Available
                  </h5>
                </div>
                <div class = "col-sm-4">
                  <h5>
                    <span class = "badge badge-primary">&nbsp;&nbsp;</span>
                    Available
                  </h5>
                </div>
                <div class = "col-sm-4">
                  <h5>
                    <span class = "badge badge-success">&nbsp;&nbsp;</span>
                    Booked
                  </h5>
                </div>
              </div>
              <br>
              <div class = "card">
                <div class = "card-body">
                  <div class = "row">
                    <div class = "col-sm-12">
                      <div class = "card">
                        <div class = "card-body">
                          <center>
                            <h4>Seats</h4>
                          </center>
                        </div>
                      </div>
                    </div>
                  </div>
                  <br>
                  <div class = "row">
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS1
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US1
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type = "button" class = "btn btn-primary seat-btn">
                          LS6
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type = "button" class = "btn btn-primary seat-btn">
                          US6
                        </button>
                      </center>
                    </div>
                  </div>
                  <br>
                  <div class = "row">
                    <div class = "col-sm-3">
                      <center>
                        <button type = "button" class = "btn btn-primary seat-btn">
                          LS2
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type = "button" class = "btn btn-primary seat-btn">
                          US2
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type = "button" class = "btn btn-primary seat-btn">
                          LS7
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US7
                        </button>
                      </center>
                    </div>
                  </div>
                  <br>
                  <div class = "row">
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS3
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US3
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS8
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US8
                        </button>
                      </center>
                    </div>
                  </div>
                  <br>
                  <div class = "row">
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS4
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US4
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS9
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US9
                        </button>
                      </center>
                    </div>
                  </div>
                  <br>
                  <div class = "row">
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS5
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US5
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          LS10
                        </button>
                      </center>
                    </div>
                    <div class = "col-sm-3">
                      <center>
                        <button type =  "button" class = "btn btn-primary seat-btn">
                          US10
                        </button>
                      </center>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class = "col-sm-4">
              <br>
              <div class = "row">
                <div class = "col-sm-6">
                  <div class = "card1">
                    <div class = "card-body1">
                      <center>
                        <h6>CLASS</h6>
                        <h1>AC-SL</h1>
                        <h6>5 / 25</h6>
                        <h6><b>Rs. 3000</b></h6>
                        <button class = "btn btn-primary">Book Now</button>
                      </center>
                    </div>
                  </div>
                </div>
                <div class = "col-sm-6">
                  <div class = "card1">
                    <div class = "card-body1">
                      <center>
                        <h6>CLASS</h6>
                        <h1>NON-SL</h1>
                        <h6>6 / 25</h6>
                        <h6><b>Rs. 2000</b></h6>
                        <button class = "btn btn-primary">Book Now</button>
                      </center>
                    </div>
                  </div>
                </div>
              </div>
              <br>
              <div class = "row">
                <div class = "col-sm-6">
                  <div class = "card1">
                    <div class = "card-body1">
                      <center>
                        <h6>CLASS</h6>
                        <h1>AC-SE</h1>
                        <h6>10 / 25</h6>
                        <h6><b>Rs. 1500</b></h6>
                        <button class = "btn btn-primary">Book Now</button>
                      </center>
                    </div>
                  </div>
                </div>
                <div class = "col-sm-6">
                  <div class = "card1">
                    <div class = "card-body1">
                      <center>
                        <h6>CLASS</h6>
                        <h1>NON-SE</h1>
                        <h6>4 / 25</h6>
                        <h6><b>Rs. 1000</b></h6>
                        <button class = "btn btn-primary">Book Now</button>
                      </center>
                    </div>
                  </div>
                </div>
              </div>
              <br>
              <h5>
                <span class = "badge badge-danger">LS</span>
                Lower Seat
                <span class = "badge badge-danger" style="margin-left:25px;">US</span>
                Upper Seat
              </h5>
              <h5 style="white-space: nowrap;">
                <span class = "badge badge-danger">AC-SL</span>
                AC Sleeper 
                <span class = "badge badge-danger">NON-SL</span>
                NON AC- Sleeper
              </h5>
              <h5 style="white-space: nowrap;">
                <span class = "badge badge-danger">AC-SE</span>
                AC- Seater
                <span class = "badge badge-danger">NON-SE</span>
                 NON AC- Seater
              </h5>
              <br>
            </div>
          </div>
        </div>
      <center>
        <br>
        <button
          type="submit"
          class="btn"
          style="background-color: black; color: white"
          id="book-ticket-btn"
        >
          Click Here to Enter Passenger Details
        </button>
        <br>
      </center>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      function createTicket(selectedClass, bookedSeatsByClass) {
        $.get(
          `http://localhost:8080/api/create-ticket?pnr=123&busId=123&paymentMethod=netbanking&amount=2500&passengerEmail=r.rahul.developer@gmail.com&passengerMobileNumber=8002030975`
        );
      }

      $(document).ready(function () {
        var bookedSeatsByClass = {
          "AC-SL": [],
          "AC-SE": [],
          "NON-SL": [],
          "NON-SE": [],
        };
        var selectedClass = null;

        function updateSeatDisplay() {
          $(".seat-btn").css("background-color", ""); // Reset all seats to default color
          if (selectedClass && bookedSeatsByClass[selectedClass]) {
            bookedSeatsByClass[selectedClass].forEach(function (seatId) {
              $(".seat-btn")
                .filter(function () {
                  return $(this).text().trim() === seatId;
                })
                .css("background-color", "green");
            });
          }
        }

        $(".seat-btn").click(function () {
          if (!selectedClass) {
            alert("Please select a class first!");
            return;
          }

          var seatId = $(this).text().trim();

          if ($(this).css("background-color") === "rgb(0, 128, 0)") {
            $(this).css("background-color", ""); // Reset to default color
            var index = bookedSeatsByClass[selectedClass].indexOf(seatId);
            if (index !== -1) {
              bookedSeatsByClass[selectedClass].splice(index, 1);
            }
          } else {
            $(this).css("background-color", "green");
            if (!bookedSeatsByClass[selectedClass].includes(seatId)) {
              bookedSeatsByClass[selectedClass].push(seatId);
            }
          }

          console.log("Booked Seats for all classes:", bookedSeatsByClass);
        });

        $(".card1 .btn-primary").click(function (e) {
          e.preventDefault();

          $(".card1 .btn-primary").css("background-color", ""); // Reset all class buttons
          $(this).css("background-color", "green"); // Highlight selected class button

          selectedClass = $(this).closest(".card-body1").find("h1").text();
          console.log("Selected Class:", selectedClass);

          updateSeatDisplay();
        });

        $("#book-ticket-btn").click(function (e) {
          e.preventDefault();
          if (
            !selectedClass ||
            bookedSeatsByClass[selectedClass].length === 0
          ) {
            alert(
              "Please select a class and at least one seat before booking."
            );
            return;
          }
          const searchParams = new URLSearchParams(window.location.search);
          const busId = searchParams.get("bus_number");
          const queryParams = new URLSearchParams({
            busId: busId,
            bookedSeatsByClass: JSON.stringify(bookedSeatsByClass),
            selectedClass: selectedClass,
          });
          window.location.href = `/passenger_details?${queryParams}`;
        });

        // Initialize with no class selected
        updateSeatDisplay();
      });

      function createTicket(selectedClass, bookedSeatsByClass) {
        $.get(
          `http://localhost:8080/api/create-ticket?pnr=123&busId=123&paymentMethod=netbanking&amount=2500&passengerEmail=r.rahul.developer@gmail.com&passengerMobileNumber=8002030975`
        );
      }

      function clearCache() {
        const cacheBusNumber = localStorage.getItem("bus_number");
        if (cacheBusNumber) {
          localStorage.removeItem("bus_number");
        }
      }

      clearCache();
    </script>
  </body>
</html>